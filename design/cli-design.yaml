# ABOUTME: CLI design principles and command structure
# ABOUTME: Simple, sexy, well-thought-out syntax

principles:
  - CLI native - command-line tool first
  - Simple and sexy syntax
  - Minimal typing for common operations
  - Auto-commit each change for granular undo
  - Single tool use, multiple commits when batching

auto_commit:
  description: |
    Every rivet command that modifies rivet.yaml automatically commits the change.
    Single tool use, atomic operation, git handles undo.

  behavior: |
    1. Read rivet.yaml
    2. Make change
    3. Write rivet.yaml
    4. git add rivet.yaml
    5. git commit -m "rivet: <operation description>"

  batch_behavior: |
    When using rivet sync with multiple operations, each operation gets its
    own commit in sequence. One tool use, multiple commits.

    Example: rivet sync --add Router "..." --deprecate OldRouter
    Creates two commits:
      1. "rivet: add Router"
      2. "rivet: deprecate OldRouter"

    Each can be reverted individually with git revert.

  flags:
    --no-commit: "Skip auto-commit for this operation"

commands:

  # Context / Reading
  context:
    usage: "rivet context [system...]"
    description: |
      Output context for AI consumption. Dumps project info, systems,
      requirements, relationships.
    examples:
      - "rivet context              # all systems"
      - "rivet context Router       # just Router"
      - "rivet context Router Config # multiple systems"

  # Core operations (each auto-commits)
  init:
    usage: "rivet init [--minimal]"
    description: "Initialize Rivet in a project. Interactive or minimal."

  add:
    usage: "rivet add <name> <description>"
    description: "Add a new system"
    commit_message: "rivet: add <name>"

  show:
    usage: "rivet show <name>"
    description: "Show details of one system (no commit, read-only)"

  list:
    usage: "rivet list [--status <status>]"
    description: "List all systems (no commit, read-only)"

  require:
    usage: "rivet require <system> <statement>"
    description: "Add requirement to a system (the WHAT)"
    commit_message: "rivet: require <system> '<statement>'"

  decide:
    usage: "rivet decide <system> <statement>"
    description: "Add a design decision to a system (the WHY)"
    commit_message: "rivet: decide <system> '<statement>'"

  term:
    usage: "rivet term <system> <term>"
    description: |
      Lock a term to a specific system. System-level terms are code names,
      function names, class names - locked vocabulary for that system.
      For project-wide terms not tied to any system, use 'rivet define'.
    commit_message: "rivet: term <system> <term>"
    examples:
      - "rivet term Router createRouter      # createRouter belongs to Router"
      - "rivet term Config loadConfig        # loadConfig belongs to Config"

  purge:
    usage: "rivet purge <old-term> <new-term>"
    description: |
      Rename a term across the codebase. Uses ripgrep to find occurrences,
      provides AI with instructions to replace. Updates rivet.yaml terms.
    commit_message: "rivet: purge <old-term> → <new-term>"

  define:
    usage: "rivet define <term> <definition>"
    description: |
      Add a PROJECT-WIDE glossary term. Unlike 'rivet term' which locks a
      term to a specific system, 'define' creates vocabulary that applies
      across the entire codebase - concepts, jargon, conventions.

      Use 'define' for: concepts, methodology terms, project-specific jargon
      Use 'term' for: code names, function names, class names tied to a system
    commit_message: "rivet: define <term>"
    examples:
      - "rivet define vibe_coding 'AI handles implementation while human guides'"
      - "rivet define harvest 'extracting requirements from transcripts'"
      - "rivet define system 'cohesive code bundle forming single mental model'"

  link:
    usage: "rivet link <system> --depends-on|--used-by <other>"
    description: "Add relationship between systems"
    commit_message: "rivet: link <system> -> <other>"

  deprecate:
    usage: "rivet deprecate <system> [--replaced-by <new>]"
    description: "Mark system as deprecated, optionally specify replacement"
    commit_message: "rivet: deprecate <system> [replaced by <new>]"

  # Batch operations
  sync:
    usage: "rivet sync [operations...]"
    description: |
      Run multiple operations in one command. Each operation gets its own
      commit for granular undo. This is THE command for end-of-session updates -
      capture all systems, requirements, decisions, terms, and glossary in one call.
    examples:
      - "rivet sync --add Router 'handles routing' --deprecate OldRouter"
      - "rivet sync --add Foo 'desc' --require Foo 'must do X' --term Foo createFoo"
      - "rivet sync --define vibe_coding 'AI handles implementation' --decide Router 'async-first for scale'"
    flags:
      --add: "<name> <description>"
      --require: "<system> <statement>"
      --decide: "<system> <statement>"
      --term: "<system> <term>"
      --define: "<term> <definition>"
      --link: "<system> --depends-on|--used-by <other>"
      --deprecate: "<name> [--replaced-by <new>]"

  # Views (read-only, no commits)
  arch:
    usage: "rivet arch"
    aliases: ["architecture"]
    description: "Show architecture overview - all systems and relationships"

  reqs:
    usage: "rivet reqs [system]"
    description: "Show requirements. All, or filtered to one system."

  terms:
    usage: "rivet terms"
    description: "Show all locked terms - both system terms and project glossary"

  # Checking (read-only, no commits)
  check:
    usage: "rivet check"
    description: "Grep codebase for terms, report matches/mismatches"

  orphans:
    usage: "rivet orphans"
    description: "Find orphaned requirements (parent system deprecated/removed)"

  history:
    usage: "rivet history [system] [--requirement <req>] [--decision <dec>]"
    description: |
      Show provenance of requirements/decisions via git history.
      When was it added? By whom? In what context?
    examples:
      - "rivet history Router                    # all changes to Router"
      - "rivet history --requirement 'must handle X'  # when was this added?"

  # Layout (optional codebase organization)
  layout:
    usage: "rivet layout [flavor]"
    description: "Show current layout, or set to a flavor"
    examples:
      - "rivet layout                # show current"
      - "rivet layout standard-ts    # adopt standard-ts layout"
      - "rivet layout check          # verify codebase matches layout"

# Workflow summary:
# 1. rivet context → AI gets context
# 2. Conversation about changes, naming negotiation
# 3. AI runs commands (direct or sync)
# 4. Each change auto-committed
# 5. Don't like something? git revert the specific commit
